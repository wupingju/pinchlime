{% import "macros.html" as macro -%}
{% set_global target_lang = "en" -%}
{% set_global lang_prefix_path = "/" -%}
{% if config.default_language != lang -%}
{% set_global target_lang = "zh-TW" -%}
{% set_global lang_prefix_path = "/"~lang~"/" -%}
{% endif -%}
{% set_global file_lang_path = "" -%}
{% if config.default_language != lang -%}
{% set_global file_lang_path = "." ~ lang -%}
{% endif -%}
{% set all_section_pages = get_section(path="_index"~file_lang_path~".md") -%}
{% set all_pages_sort_by_date = all_section_pages.pages | sort(attribute="updated") | reverse  -%}
{% set total_word_count = 0 -%}
{% for page_item in all_section_pages.pages -%}
  {% set_global total_word_count = total_word_count+page_item.word_count -%}
{% endfor -%}
<!DOCTYPE html>
<html
  lang="{% if page.extra.lang %}{{ page.extra.lang }}{% else %}{{ lang }}{% endif %}"
  itemscope
  itemtype="http://schema.org/Blog"
>
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1" />

    <link rel="stylesheet" href="{{ get_url(path="site/styles/site.css",
    trailing_slash=false,cachebust=true) | safe }}">
    <title>{% block title %}{{ config.title }}{% endblock title %}</title>

    {% if config.generate_rss %} <link rel="alternate"
    type="application/rss+xml" title="RSS" href="{{ get_url(path="rss.xml") }}">
    {% endif %}
    <meta
      name="description"
      itemprop="about"
      content="{% block description -%}{{ config.description }}{% endblock description -%}"
    />
    <meta
      name="keywords"
      itemprop="keywords"
      content="{{ trans(key="keywords",lang=lang) }}"
    />
    <meta name="author" itemprop="author" content="{{ config.extra.author }}" />
    <meta itemprop="headline" content="{{ config.title }}" />
    <meta itemprop="copyrightYear" content="{{ now() | date(format="%Y") }}" />
    <link rel="icon" href="{{ get_url(path="site/images/favicon-32x32.png",cachebust=true) }}"
    type="image/x-icon"> <link rel="apple-touch-icon" sizes="57x57" href="{{
    get_url(path="site/images/apple-icon-57x57.png",cachebust=true) }}"> <link
    rel="apple-touch-icon" sizes="60x60" href="{{
    get_url(path="site/images/apple-icon-60x60.png",cachebust=true) }}"> <link
    rel="apple-touch-icon" sizes="72x72" href="{{
    get_url(path="site/images/apple-icon-72x72.png",cachebust=true) }}"> <link
    rel="apple-touch-icon" sizes="76x76" href="{{
    get_url(path="site/images/apple-icon-76x76.png",cachebust=true) }}"> <link
    rel="apple-touch-icon" sizes="114x114" href="{{
    get_url(path="site/images/apple-icon-114x114.png",cachebust=true) }}"> <link
    rel="apple-touch-icon" sizes="120x120" href="{{
    get_url(path="site/images/apple-icon-120x120.png",cachebust=true) }}"> <link
    rel="apple-touch-icon" sizes="144x144" href="{{
    get_url(path="site/images/apple-icon-144x144.png",cachebust=true) }}"> <link
    rel="apple-touch-icon" sizes="152x152" href="{{
    get_url(path="site/images/apple-icon-152x152.png",cachebust=true) }}"> <link
    rel="apple-touch-icon" sizes="180x180" href="{{
    get_url(path="site/images/apple-icon-180x180.png",cachebust=true) }}"> <link rel="icon"
    type="image/png" sizes="192x192" href="{{
    get_url(path="site/images/android-icon-192x192.png",cachebust=true) }}"> <link rel="icon"
    type="image/png" sizes="32x32" href="{{
    get_url(path="site/images/favicon-32x32.png",cachebust=true) }}"> <link rel="icon"
    type="image/png" sizes="96x96" href="{{
    get_url(path="site/images/favicon-96x96.png",cachebust=true) }}"> <link rel="icon"
    type="image/png" sizes="16x16" href="{{
    get_url(path="site/images/favicon-16x16.png",cachebust=true) }}"> <link rel="manifest"
    href="{{ get_url(path="site/images/manifest.json") }}">
    <meta name="msapplication-TileColor" content="{{ config.extra.theme_color }}" />
    <meta name="msapplication-TileImage" content="{{
    get_url(path="site/images/ms-icon-144x144.png",cachebust=true) }}">
    <meta name="theme-color" content="{{ config.extra.theme_color }}" />

    <meta
      property="og:title"
      content="{% block ogtitle %}{{ config.title }}{% endblock ogtitle %}"
    />
    <meta
      property="og:description"
      content="{% block ogdesc %}{{ config.description }}{% endblock ogdesc %}"
    />
    <meta
      property="og:url"
      content="{% block ogurl %}{{ config.base_url~lang_prefix_path | safe }}{% endblock ogurl%}"
    />
    <meta property="og:site_name" content="{{ config.title }}" />
    {% if config.extra.image %}
    <meta property="og:image" content="https://pinchlime-screenshots.s3.ap-northeast-1.amazonaws.com/og-pinchlime-logo_Huhf2P.png" />
    <meta property="og:image:width" content="600"/>
    <meta property="og:image:height" content="600"/>
    {% endif %}
    <meta name="twitter:card" content="summary" />
    {% if config.extra.twitter_user %}
    <meta name="twitter:site" content="{{ config.extra.twitter_user }}" />
    <meta name="twitter:creator" content="{{ config.extra.twitter_user }}" />
    <meta name="twitter:image" content="https://pinchlime-screenshots.s3.ap-northeast-1.amazonaws.com/og-pinchlime-logo_Huhf2P.png" />
    <meta
      name="twitter:image:alt"
      content="{% block ogaltimg %}{{ config.title }}{% endblock ogaltimg %}"
    />
    {% endif %}  {% if config.extra.google_analytics %}
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id={{config.extra.google_analytics}}"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', '{{config.extra.google_analytics}}');
    </script>
    {% endif %}
    {% block post_meta %}{% endblock post_meta %}
  </head>

  <body>
    <section id="top"></section>
    <section id="root" >
      {% block body_zone -%}
      <main class="body-zone flex justify-between flex-1">
          <section class="main flex-1">
            <div class="main-inner px">
              {% block main %}
              {% endblock main %}

              </div>
            </section>

          {% block sidebar %}
          <aside class="sidebar px">

          <h2><a class="no-underline" href="{{lang_prefix_path}}categories/">{{ trans(key="label_categories",lang=lang) }}</h2></a>
          <ul>
            {% set categories = get_taxonomy(kind="categories",lang=lang) %} {% for cat in
            categories.items %}
            {% set url = get_taxonomy_url(kind="categories",lang=lang, name=cat.name) %}
            <li>
              <a class="no-underline" href="{{ url }}"
                >{{ cat.name }} ({{ cat.pages | length }})</a
              >
            </li>
            {% endfor %}
          </ul>
          {% set custom_sidebar = get_section(path="sidebar/_index"~file_lang_path~".md") %} 
            {{ custom_sidebar.content | safe }}

          <h2>{{trans(key="label_new_posts_list_title",lang=lang) | markdown(inline=true) | safe}}</h2>
          <ul>
            {% set all_blog_pages = get_section(path="blog/_index"~file_lang_path~".md") -%}
            {% for page in all_blog_pages.pages | slice(start=0,end=5)  %} 
            <li>
              <a class="no-underline">
                {{ macro::post_side(page=page) }}
              </a>
            </li>
            {% endfor %} 
          </ul>
          <h2>最新電子報</h2>
          <ul>
            {% set all_blog_pages = get_section(path="newsletters/_index"~file_lang_path~".md") -%}
            {% for page in all_blog_pages.pages | slice(start=0,end=5)  %} 
            <li>
              {{ macro::newsletters_side(page=page) }}
            </li>
            {% endfor %} 
          </ul>
          <h2>看更多文章</h2>
          <ul>
            <li class="no-underline">
              <a href="/tag-list/">依{{ trans(key="label_tags",lang=lang) }}</a>
            </li>
            <li class="no-underline">
              <a href="/archive/">依時序</a>
            </li>
          </ul>
          <h2><a href="{{ get_url(path="@/_index.md",lang=lang) }}"> 回到{{trans(key="label_home",lang=lang)}}</a></h2><br>
        </aside>
          {% endblock sidebar %}
      </main>
      {% endblock body_zone -%}
   
    </section>
    <section id="bottom"></section>
  </body>
</html>